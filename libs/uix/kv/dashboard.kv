#:import AKDualBarChart libs.applibs.dualbarchart

<LandingScreen1>:
    name: "land"
    theme_bg_color: "Custom"
    md_bg_color: app.getval("BACKGROUND_COLOR")
    MDBoxLayout:
        orientation: "vertical"
        # Fixed Top App Bar
        MDTopAppBar:
            theme_bg_color: "Custom"
            md_bg_color: app.getval("PRIMARY_COLOR")
            elevation: 5
            pos_hint: {"top": 1}
            MDTopAppBarLeadingButtonContainer:
                MDActionTopAppBarButton:
                    icon: "menu"
                    on_release: app.root.children[0].set_state("open")
            MDTopAppBarTitle:
                text: "NexGen"
                pos_hint: {"center_x": .5}
            MDTopAppBarTrailingButtonContainer:
                # pos_hint: {"center_x": 1, "center_y": .5}

                MDActionTopAppBarButton:
                    icon: "logout"
                    on_release: app.logout()
           
        ScrollView:  # Replaces the ScrollView
            id: refresh_layout  # Add this to reference for refresh completion
            MDBoxLayout:
                id:mainbox
                orientation: "vertical"
                adaptive_height: True
                padding: "16dp"
                spacing: "5dp"
                # size_hint_y: "100dp"
                # Total Members Card
                MDBoxLayout:
                    id:subbox
                    orientation: "horizontal"
                    adaptive_height: True
                    spacing: "5dp"
                    # Active Members
                    MDCard:
                        orientation: "vertical"
                        spacing: "15dp"
                        size_hint_x: 0.3
                        size_hint_y: None
                        height: self.minimum_height
                        pos_hint: {"center_x": 0.5}
                        radius: [20, 20, 20, 20]
                        style: "elevated"
                        theme_shadow_color: "Custom"
                        shadow_color: (0, 0, 0, 0.1) 
                        theme_bg_color: "Custom"
                        md_bg_color: app.getval("CARD_BACKGROUND")  # Blue color
                        
                        FitImage:
                            source: "assets/project_icons/live-streaming_13437574.png"  # Replace with your image path
                            size_hint: None, None
                            size: "50dp", "50dp"
                            pos_hint: {"center_x": 0.5}
                            # radius: [50, 50, 50, 50]
                        
                        MDLabel:
                            text: "Active Members"
                            font_style: "Title"
                            role: "small"
                            halign: "left"
                            halign: "center"
                            adaptive_height: True
                            pos_hint: {"center_y": 0.5}
                            theme_text_color: "Custom"
                            text_color: app.getval("TEXT_PRIMARY")
                        MDLabel:
                            text: root.active_members
                            font_style: "Title"
                            role: "large"
                            halign: "left"
                            halign: "center"
                            adaptive_height: True
                            pos_hint: {"center_y": 0.5}
                            theme_text_color: "Custom"
                            text_color: app.getval("TEXT_PRIMARY")
                            
                    # Expired members
                    MDCard:
                        orientation: "vertical"
                        spacing: "15dp"
                        size_hint_x: 0.3
                        size_hint_y: None
                        height: self.minimum_height
                        pos_hint: {"center_x": 0.5}
                        radius: [20, 20, 20, 20]
                        style: "elevated"
                        theme_shadow_color: "Custom"
                        shadow_color: (0, 0, 0, 0.1) 
                        theme_bg_color: "Custom"
                        md_bg_color: app.getval("CARD_BACKGROUND")  # Blue color
                        
                        FitImage:
                            source: "assets/project_icons/partner_4237167.png"  # Replace with your image path
                            size_hint: None, None
                            size: "50dp", "50dp"
                            pos_hint: {"center_x": 0.5}
                            # radius: [50, 50, 50, 50]  # Ensures circular shape

                        MDLabel:
                            text: "Expired Subcriptions"
                            font_style: "Title"
                            role: "small"
                            halign: "left"
                            halign: "center"
                            adaptive_height: True
                            pos_hint: {"center_y": 0.5}
                            theme_text_color: "Custom"
                            text_color: app.getval("TEXT_PRIMARY")
                        MDLabel:
                            text: root.expired_count
                            font_style: "Title"
                            role: "large"
                            halign: "left"
                            halign: "center"
                            adaptive_height: True
                            pos_hint: {"center_y": 0.5}
                            theme_text_color: "Custom"
                            text_color: app.getval("TEXT_PRIMARY")
                # P&L
                MDBoxLayout:
                    id:subbox
                    orientation: "horizontal"
                    adaptive_height: True
                    spacing: "5dp"
                    MDCard:
                        orientation: "vertical"
                        spacing: "15dp"
                        size_hint_x: 0.3
                        size_hint_y: None
                        height: self.minimum_height
                        pos_hint: {"center_x": 0.5}
                        radius: [20, 20, 20, 20]
                        style: "elevated"
                        theme_shadow_color: "Custom"
                        shadow_color: (0, 0, 0, 0.1) 
                        theme_bg_color: "Custom"
                        md_bg_color: app.getval("CARD_BACKGROUND")  # Blue color
                        MDFloatLayout:
                            padding: "10dp"
                            # adaptive_height: True
                            pos_hint: {"center_x": 0.8, "center_y": 0.5}
                            MDIconButton:
                                id: expense_btn
                                icon: "information"
                                style: "standard"
                                pos_hint: {"center_x": 0.5, "top":1}
                                on_release: root.show_tooltip(self,root.pnl_amount_absolute,775)
                        
                        FitImage:
                            source: "assets/project_icons/trend_2601595.png"  # Replace with your image path
                            size_hint: None, None
                            size: "50dp", "50dp"
                            pos_hint: {"center_x": 0.5}
                            # radius: [50, 50, 50, 50]
                        
                        MDLabel:
                            text: "Current Month P&L"
                            font_style: "Title"
                            role: "small"
                            halign: "left"
                            halign: "center"
                            adaptive_height: True
                            pos_hint: {"center_y": 0.5}
                            theme_text_color: "Custom"
                            text_color: app.getval("TEXT_PRIMARY")
                        MDLabel:
                            text: root.pnl_amount
                            font_style: "Title"
                            role: "large"
                            halign: "left"
                            halign: "center"
                            adaptive_height: True
                            pos_hint: {"center_y": 0.5}
                            theme_text_color: "Custom"
                            text_color: app.getval("TEXT_PRIMARY")
                            
                    # Net P&L
                    MDCard:
                        orientation: "vertical"
                        spacing: "15dp"
                        size_hint_x: 0.3
                        size_hint_y: None
                        height: self.minimum_height
                        pos_hint: {"center_x": 0.5}
                        radius: [20, 20, 20, 20]
                        style: "elevated"
                        theme_shadow_color: "Custom"
                        shadow_color: (0, 0, 0, 0.1) 
                        theme_bg_color: "Custom"
                        md_bg_color: app.getval("CARD_BACKGROUND")  # Blue color
                        MDFloatLayout:
                            padding: "10dp"
                            # adaptive_height: True
                            pos_hint: {"center_x": 0.8, "center_y": 0.5}
                            MDIconButton:
                                id: pnl_btn
                                icon: "information"
                                style: "standard"
                                pos_hint: {"center_x": 0.5, "top":1}
                                on_release: root.show_tooltip(self,root.net_pnl_absolute,775)
                        
                        FitImage: 
                            source: "assets/project_icons/profit_12177228.png"  # Replace with your image path
                            size_hint: None, None
                            size: "50dp", "50dp"
                            pos_hint: {"center_x": 0.5}
                            # radius: [50, 50, 50, 50]  # Ensures circular shape

                        MDLabel:
                            text: "Net P&L"
                            font_style: "Title"
                            role: "small"
                            halign: "left"
                            halign: "center"
                            adaptive_height: True
                            pos_hint: {"center_y": 0.5}
                            theme_text_color: "Custom"
                            text_color: app.getval("TEXT_PRIMARY")
                        
                        MDLabel:
                            text: root.net_pnl
                            font_style: "Title"
                            role: "large"
                            halign: "left"
                            halign: "center"
                            adaptive_height: True
                            pos_hint: {"center_y": 0.5}
                            theme_text_color: "Custom"
                            text_color: app.getval("TEXT_PRIMARY")
                
                # Total Collection 
                MDBoxLayout:
                    id:subbox1
                    orientation: "horizontal"
                    adaptive_height: True
                    spacing: "5dp"
                    MDCard:
                        orientation: "vertical"
                        spacing: "15dp"
                        size_hint_x: 0.3
                        size_hint_y: None
                        height: self.minimum_height
                        pos_hint: {"center_x": 0.5}
                        radius: [20, 20, 20, 20]
                        style: "elevated"
                        theme_shadow_color: "Custom"
                        shadow_color: (0, 0, 0, 0.1) 
                        theme_bg_color: "Custom"
                        md_bg_color: app.getval("CARD_BACKGROUND")  # Blue color
                        MDFloatLayout:
                            padding: "10dp"
                            # adaptive_height: True
                            pos_hint: {"center_x": 0.8, "center_y": 0.5}
                            MDIconButton:
                                id: collection_btn
                                icon: "information"
                                style: "standard"
                                pos_hint: {"center_x": 0.5, "top":1}
                                on_release: root.show_tooltip(self,root.collection_amount_absolute,460)
                        
                        FitImage:
                            source: "assets/project_icons/pay_625599.png"  # Replace with your image path
                            size_hint: None, None
                            size: "50dp", "50dp"
                            pos_hint: {"center_x": 0.5}
                            # radius: [50, 50, 50, 50]
                        
                        MDLabel:
                            text: "Total Collection"
                            font_style: "Title"
                            role: "small"
                            halign: "left"
                            halign: "center"
                            adaptive_height: True
                            pos_hint: {"center_y": 0.5}
                            theme_text_color: "Custom"
                            text_color: app.getval("TEXT_PRIMARY")
                        MDLabel:
                            text: root.collection_amount
                            font_style: "Title"
                            role: "large"
                            halign: "left"
                            halign: "center"
                            adaptive_height: True
                            pos_hint: {"center_y": 0.5}
                            theme_text_color: "Custom"
                            text_color: app.getval("TEXT_PRIMARY")
                            
                    # Total Expense
                    MDCard:
                        orientation: "vertical"
                        spacing: "15dp"
                        size_hint_x: 0.3
                        size_hint_y: None
                        height: self.minimum_height
                        pos_hint: {"center_x": 0.5}
                        radius: [20, 20, 20, 20]
                        style: "elevated"
                        theme_shadow_color: "Custom"
                        shadow_color: (0, 0, 0, 0.1) 
                        theme_bg_color: "Custom"
                        md_bg_color: app.getval("CARD_BACKGROUND")  # Blue color
                        MDFloatLayout:
                            padding: "10dp"
                            # adaptive_height: True
                            pos_hint: {"center_x": 0.8, "center_y": 0.5}
                            MDIconButton:
                                id: expense_btn
                                icon: "information"
                                style: "standard"
                                pos_hint: {"center_x": 0.5, "top":1}
                                on_release: root.show_tooltip(self,root.expense_amount_absolute,460)
                        
                        FitImage:
                            source: "assets/project_icons/money_13680601.png"  # Replace with your image path
                            size_hint: None, None
                            size: "50dp", "50dp"
                            pos_hint: {"center_x": 0.5}
                            # radius: [50, 50, 50, 50]  # Ensures circular shape

                        MDLabel:
                            text: "Total Expense"
                            font_style: "Title"
                            role: "small"
                            halign: "left"
                            halign: "center"
                            adaptive_height: True
                            pos_hint: {"center_y": 0.5}
                            theme_text_color: "Custom"
                            text_color: app.getval("TEXT_PRIMARY")
                        MDLabel:
                            text: root.expense_amount
                            font_style: "Title"
                            role: "large"
                            halign: "left"
                            halign: "center"
                            adaptive_height: True
                            pos_hint: {"center_y": 0.5}
                            theme_text_color: "Custom"
                            text_color: app.getval("TEXT_PRIMARY")

                # Spacer between cards
                Widget:
                    size_hint_y: None
                    height: "20dp"
                # Available Seats Card (with right arrow)
                MDCard:
                    orientation: "vertical"
                    padding: "16dp"
                    size_hint_x: 1
                    size_hint_y: None
                    height: self.minimum_height
                    pos_hint: {"center_x": 0.5}
                    radius: [20, 20, 20, 20]
                    style: "elevated"
                    elevation:0.8
                    theme_shadow_color: "Custom"
                    shadow_color: (0, 0, 0, 0.1) 
                    theme_bg_color: "Custom"
                    md_bg_color: app.getval("CARD_BACKGROUND")
                    MDBoxLayout:
                        orientation: "horizontal"
                        spacing: "10dp"
                        adaptive_height: True
                        MDLabel:
                            text: "Available Seats"
                            font_style: "Title"
                            role:"large"
                            halign: "left"
                            theme_text_color: "Custom"
                            text_color: app.getval("TEXT_PRIMARY")
                        FitImage:
                            source: "assets/img/Blog post-bro.png"
                            size_hint: None, None
                            fit_mode: "fill"
                            # size: 300, 300
                            pos_hint: {"top": 1, "right": 1}
                            opacity: 1  # Adjust opacity (0 = fully transparent, 1 = fully visible)
                        # MDIconButton:
                        #     icon: "arrow-right"
                        #     pos_hint: {"center_y": 0.5}
                        #     on_release: root.availble_seats_popup()  # Right arrow opens popup

                    MDBoxLayout:
                        orientation: "horizontal"
                        adaptive_height: True
                        spacing: "10dp"
                        MDBoxLayout:
                            orientation: "vertical"
                            adaptive_height: True
                            MDLabel:
                                text: "1st Shift"
                                font_style: "Title"
                                role:"small"
                                halign: "center"
                                adaptive_height: True
                                theme_text_color: "Custom"
                                text_color: app.getval("TEXT_SECONDARY")
                            MDLabel:
                                id: morningshift
                                text: "0"
                                font_style: "Title"
                                role:"medium"
                                halign: "center"
                                adaptive_height: True
                                theme_text_color: "Custom"
                                text_color: app.getval("TEXT_PRIMARY")
                        MDBoxLayout:
                            orientation: "vertical"
                            adaptive_height: True
                            MDLabel:
                                text: "2nd Shift"
                                font_style: "Title"
                                role:"small"
                                halign: "center"
                                adaptive_height: True
                                theme_text_color: "Custom"
                                text_color: app.getval("TEXT_SECONDARY")
                            MDLabel:
                                id: afternoonshift
                                text: "0"
                                font_style: "Title"
                                role:"medium"
                                halign: "center"
                                adaptive_height: True
                                theme_text_color: "Custom"
                                text_color: app.getval("TEXT_PRIMARY")
                        MDBoxLayout:
                            orientation: "vertical"
                            adaptive_height: True
                            MDLabel:
                                text: "3rd Shift"
                                font_style: "Title"
                                role:"small"
                                halign: "center"
                                adaptive_height: True
                                theme_text_color: "Custom"
                                text_color: app.getval("TEXT_SECONDARY")
                            MDLabel:
                                id: eveningshift
                                text: "0"
                                font_style: "Title"
                                role:"medium"
                                halign: "center"
                                adaptive_height: True
                                theme_text_color: "Custom"
                                text_color: app.getval("TEXT_PRIMARY")
                        MDBoxLayout:
                            orientation: "vertical"
                            adaptive_height: True
                            MDLabel:
                                text: "4th Shift"
                                font_style: "Title"
                                role:"small"
                                halign: "center"
                                adaptive_height: True
                                theme_text_color: "Custom"
                                text_color: app.getval("TEXT_SECONDARY")
                            MDLabel:
                                id: nightshift
                                text: "0"
                                font_style: "Title"
                                role:"medium"
                                halign: "center"
                                adaptive_height: True
                                theme_text_color: "Custom"
                                text_color: app.getval("TEXT_PRIMARY")
                        MDBoxLayout:
                            orientation: "vertical"
                            adaptive_height: True
                            MDLabel:
                                text: "Weekend"
                                font_style: "Title"
                                role:"small"
                                halign: "center"
                                adaptive_height: True
                                theme_text_color: "Custom"
                                text_color: app.getval("TEXT_SECONDARY")
                            MDLabel:
                                id: weekend
                                text: "0"
                                font_style: "Title"
                                role:"medium"
                                halign: "center"
                                adaptive_height: True
                                theme_text_color: "Custom"
                                text_color: app.getval("TEXT_PRIMARY")

                Widget:
                    size_hint_y: None
                    height: "15dp"       
                MDBoxLayout:
                    id: collection_summary
                    orientation: "horizontal"
                    adaptive_height: True
                    spacing: "5dp"
                    # padding: ("39dp",0,"48dp","15dp")
                    MDLabel:
                        text: "Last 3 Months Summary"
                        font_style: "Title"
                        role:"large"
                        halign: "left"
                        adaptive_height: True
                # Spacer between cards
                Widget:
                    size_hint_y: None
                    height: "15dp"
                
                MDBoxLayout:
                    id:subboxs
                    orientation: "horizontal"
                    adaptive_height: True
                    spacing: "5dp"
                    
                    # heme_bg_color: "Custom"
                    # md_bg_color: app.getval("PRIMARY_COLOR")  # Blue color
                    
                    AKDualBarChart:
                        id: chart
                        padding:"10dp"
                        spacing: "10dp"
                        radius: [20, 20, 20, 20]
                        size_hint_y: None
                        # height: "280dp"
                        labels: True
                        anim: True
                        label_size: 15
                        bars_radius: 0
                Widget:
                    size_hint_y: None
                    height: "15dp"       
                MDBoxLayout:
                    id: admission_summary
                    orientation: "horizontal"
                    adaptive_height: True
                    spacing: "5dp"
                    # padding: ("39dp",0,"48dp","15dp")
                    MDLabel:
                        text: "Admission Summary"
                        font_style: "Title"
                        role:"large"
                        halign: "left"
                        adaptive_height: True
                # Spacer between cards
                Widget:
                    size_hint_y: None
                    height: "15dp"
                
                MDBoxLayout:
                    id:subboxss
                    orientation: "horizontal"
                    adaptive_height: True
                    spacing: "5dp"
                    
                    # heme_bg_color: "Custom"
                    # md_bg_color: app.getval("PRIMARY_COLOR")  # Blue color
                    
                    AKDualBarChart:
                        id: chart_readmission
                        padding:"10dp"
                        spacing: "10dp"
                        radius: [20, 20, 20, 20]
                        size_hint_y: None
                        # height: "280dp"
                        labels: True
                        anim: True
                        label_size: 15
                        bars_radius: 0            


                Widget:
                    size_hint_y: None
                    height: "15dp"
                MDBoxLayout:
                    orientation: "horizontal"
                    adaptive_height: True
                    spacing: "5dp"
                    # padding: ("39dp",0,"48dp","15dp")
                    MDLabel:
                        text: "Expiring Subscriptions"
                        font_style: "Title"
                        role:"large"
                        halign: "left"
                        adaptive_height: True
                    
                    MDIconButton:
                        icon: "arrow-right"
                        pos_hint: {"center_y": 0.5,"right":1}
                        on_release: root.rediret_expired_customer() # Right arrow opens pop
                MDBoxLayout:
                    id:mainboxx
                    orientation: "vertical"
                    # adaptive_height: True
                    size_hint_y: None
                    height: dp(500)
                    padding: "16dp"
                    spacing: "5dp"
                    # theme_bg_color: "Custom"
                    # md_bg_color: "#000000"
                    RecycleView:
                        id: rv
                        key_viewclass: 'viewclass'
                        key_size: 'height'
                        # height: "48dp"

                        RecycleBoxLayout:
                            padding: dp(3)
                            spacing: dp(10)
                            default_size: None, dp(99)
                            default_size_hint: 1, None
                            size_hint_y: None
                            # height: "48dp"
                            height: self.minimum_height
                            orientation: 'vertical'
                          
            
<Item1>:
    # on_release: app.screen_manager.get_screen("land").item_clicked()
    
    MDListItemLeadingAvatar:
        source: root.source
    MDListItemHeadlineText:
        text: "Headline"

    MDListItemSupportingText:
        text: "Supporting text"
    MDListItemTrailingIcon:
        icon: "whatsapp"
 
<ExpItemcard>:
    orientation:"horizontal"
    elevation: .8
    size_hint: (None, None)
    size: (dp(350), dp(350))
    padding: "10dp"
    spacing: "5dp"
    pos_hint: {"center_x": 0.5}
    radius: [20, 20, 20, 20]
    theme_bg_color: "Custom"
    md_bg_color: "#FFFFFF"
    style: "elevated"
    MDRelativeLayout:
        FitImage:
            source: root.img  # Image URL from data
            # size_hint_y=None,
            # height="80dp",

            size_hint: (None, None)
            size: (dp(60), dp(60))
            radius: [self.width/2,]
            pos_hint: {"center_y": 0.5}
        MDIconButton:
            icon:"whatsapp"
            style: "standard"
            pos_hint:{"top": 1, "right": 1}
            on_release:root.whatsappmsg(root.phone,root.msg)
        MDLabel:
            text:root.name[:25]+".." if len(root.name)>25 else root.name
            theme_text_color:"Primary"
            halign:"left"
            adaptive_size: True
            height:"24dp"
            font_style:"Title"
            role:"medium"
            pos_hint: {"center_y": 0.6,"x": 0.3}
        
        MDLabel:
            text:str(root.expdate)
            theme_text_color:"Custom"
            text_color: root.getcolor(root.expdate) if root.expdate != '' else [1,1,1,1]
            halign:"center"
            adaptive_size: True
            height:"20dp"
            font_style:"Title"
            role:"medium"
            pos_hint: {"center_y": 0.2,"right": 1}